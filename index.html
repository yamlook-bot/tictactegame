<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enhanced Tic Tac Toe - Play vs AI</title>
  <style>
    :root {
      --primary-color: #667eea;
      --secondary-color: #764ba2;
      --cell-bg: #4a4a7a;
      --cell-hover: #5e5eb9;
      --disabled-cell: #3a3a62;
      --text-color: #f0f0f0;
      --shadow: 0 10px 40px rgba(0,0,0,0.4);
    }
    
    body {
      margin: 0;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      font-family: 'Comfortaa', cursive, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: var(--text-color);
      user-select: none;
      flex-direction: column;
      padding: 20px;
    }
    
    h1 {
      margin-bottom: 20px;
      font-weight: 700;
      font-size: 2.5rem;
      text-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }
    
    .game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    
    #game-board {
      display: grid;
      grid-template-columns: repeat(3, minmax(80px, 100px));
      grid-template-rows: repeat(3, minmax(80px, 100px));
      gap: 15px;
      background: #2d2d44;
      padding: 15px;
      border-radius: 15px;
      box-shadow: var(--shadow);
    }
    
    .cell {
      background: var(--cell-bg);
      border-radius: 15px;
      font-size: clamp(2.8rem, 5vw, 3.5rem);
      font-weight: 700;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      color: #e0e0ff;
      transition: all 0.3s ease;
      aspect-ratio: 1;
    }
    
    .cell:hover:not(.disabled) {
      background: var(--cell-hover);
      transform: scale(1.05);
    }
    
    .cell.disabled {
      cursor: not-allowed;
      background: var(--disabled-cell);
    }
    
    .cell.x { color: #ff6b6b; }
    .cell.o { color: #48dbfb; }
    
    .game-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    
    #game-status {
      font-size: 1.3rem;
      font-weight: 600;
      text-align: center;
      min-height: 1.4rem;
    }
    
    .controls {
      display: flex;
      gap: 15px;
    }
    
    .game-btn {
      padding: 12px 28px;
      border: none;
      border-radius: 30px;
      background-color: var(--secondary-color);
      color: white;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(118,75,162,0.7);
      transition: background-color 0.3s ease;
    }
    
    .game-btn:hover {
      background-color: #8e61d3;
    }
    
    .game-btn:disabled {
      background-color: #5a5a5a;
      cursor: not-allowed;
      box-shadow: none;
    }
  </style>
</head>
<body>
  <h1>Enhanced Tic Tac Toe</h1>
  <div class="game-container">
    <div id="game-board" role="grid" aria-label="Tic Tac Toe Board">
      <!-- Cells will be generated by JavaScript -->
    </div>
    
    <div class="game-info">
      <div id="game-status" aria-live="polite">Player X's Turn</div>
      <div class="controls">
        <button id="reset-btn" class="game-btn">New Game</button>
        <button id="ai-toggle" class="game-btn">Play vs Friend</button>
      </div>
    </div>
  </div>

  <script>
    class TicTacToeGame {
      constructor() {
        this.board = Array(9).fill('');
        this.currentPlayer = 'X';
        this.isGameActive = true;
        this.gameMode = 'ai'; // 'ai' or 'friend'
        this.winningCombos = [
          [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
          [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
          [0, 4, 8], [2, 4, 6]             // diagonals
        ];
        
        this.initGame();
      }
      
      initGame() {
        this.cacheElements();
        this.createBoard();
        this.setupEventListeners();
        this.updateStatus();
      }
      
      cacheElements() {
        this.gameBoard = document.getElementById('game-board');
        this.statusDisplay = document.getElementById('game-status');
        this.resetButton = document.getElementById('reset-btn');
        this.aiToggleButton = document.getElementById('ai-toggle');
      }
      
      createBoard() {
        this.gameBoard.innerHTML = '';
        this.cells = [];
        
        for (let i = 0; i < 9; i++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.setAttribute('role', 'gridcell');
          cell.setAttribute('aria-label', `Position ${Math.floor(i/3)+1}-${(i%3)+1}`);
          cell.setAttribute('data-index', i);
          cell.setAttribute('tabindex', '0');
          this.gameBoard.appendChild(cell);
          this.cells.push(cell);
        }
      }
      
      setupEventListeners() {
        this.cells.forEach(cell => {
          cell.addEventListener('click', () => this.handleCellClick(cell));
          cell.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              this.handleCellClick(cell);
            }
          });
        });
        
        this.resetButton.addEventListener('click', () => this.resetGame());
        this.aiToggleButton.addEventListener('click', () => this.toggleGameMode());
      }
      
      handleCellClick(cell) {
        const index = parseInt(cell.dataset.index);
        
        if (!this.isValidMove(index)) return;
        
        this.makeMove(index);
        
        if (this.checkGameResult()) return;
        
        this.switchPlayer();
        
        if (this.gameMode === 'ai' && this.currentPlayer === 'O' && this.isGameActive) {
          setTimeout(() => this.aiMove(), 500);
        }
      }
      
      isValidMove(index) {
        return this.isGameActive && 
               this.board[index] === '' && 
               (this.gameMode === 'friend' || this.currentPlayer === 'X');
      }
      
      makeMove(index) {
        this.board[index] = this.currentPlayer;
        this.cells[index].textContent = this.currentPlayer;
        this.cells[index].classList.add(this.currentPlayer.toLowerCase());
        this.cells[index].classList.add('disabled');
      }
      
      checkGameResult() {
        const win = this.checkWin();
        
        if (win) {
          this.handleWin(win);
          return true;
        }
        
        if (this.checkDraw()) {
          this.handleDraw();
          return true;
        }
        
        return false;
      }
      
      checkWin() {
        for (const combo of this.winningCombos) {
          const [a, b, c] = combo;
          if (this.board[a] && 
              this.board[a] === this.board[b] && 
              this.board[a] === this.board[c]) {
            return combo;
          }
        }
        return null;
      }
      
      handleWin(winningCombo) {
        this.isGameActive = false;
        winningCombo.forEach(index => {
          this.cells[index].classList.add('winning-cell');
        });
        this.statusDisplay.textContent = `Player ${this.currentPlayer} Wins! ??`;
      }
      
      checkDraw() {
        return !this.board.includes('') && !this.checkWin();
      }
      
      handleDraw() {
        this.isGameActive = false;
        this.statusDisplay.textContent = "Game Ended in a Draw! ??";
      }
      
      switchPlayer() {
        this.currentPlayer = this.currentPlayer === 'X' ? 'O' : 'X';
        this.updateStatus();
      }
      
      updateStatus() {
        this.statusDisplay.textContent = `Player ${this.currentPlayer}'s Turn`;
      }
      
      aiMove() {
        const bestMove = this.findBestMove();
        if (bestMove !== -1) {
          this.makeMove(bestMove);
          
          if (!this.checkGameResult()) {
            this.switchPlayer();
          }
        }
      }
      
      findBestMove() {
        // 1. Check for winning move
        let move = this.findWinningMove('O');
        if (move !== -1) return move;
        
        // 2. Block opponent's winning move
        move = this.findWinningMove('X');
        if (move !== -1) return move;
        
        // 3. Take center if available
        if (this.board[4] === '') return 4;
        
        // 4. Take a random corner
        const corners = [0, 2, 6, 8].filter(i => this.board[i] === '');
        if (corners.length > 0) {
          return corners[Math.floor(Math.random() * corners.length)];
        }
        
        // 5. Take any available space
        const availableMoves = this.board
          .map((val, i) => val === '' ? i : -1)
          .filter(i => i !== -1);
        
        return availableMoves.length > 0 
          ? availableMoves[Math.floor(Math.random() * availableMoves.length)] 
          : -1;
      }
      
      findWinningMove(player) {
        for (const combo of this.winningCombos) {
          const [a, b, c] = combo;
          const cells = [this.board[a], this.board[b], this.board[c]];
          const playerCount = cells.filter(val => val === player).length;
          const emptyCount = cells.filter(val => val === '').length;
          
          if (playerCount === 2 && emptyCount === 1) {
            return combo[cells.indexOf('')];
          }
        }
        return -1;
      }
      
      resetGame() {
        this.board = Array(9).fill('');
        this.currentPlayer = 'X';
        this.isGameActive = true;
        
        this.cells.forEach(cell => {
          cell.textContent = '';
          cell.className = 'cell';
          cell.setAttribute('tabindex', '0');
        });
        
        this.updateStatus();
      }
      
      toggleGameMode() {
        this.gameMode = this.gameMode === 'ai' ? 'friend' : 'ai';
        this.aiToggleButton.textContent = 
          this.gameMode === 'ai' ? 'Play vs Friend' : 'Play vs AI';
        this.resetGame();
      }
    }
    
    // Initialize the game when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      new TicTacToeGame();
    });
  </script>
</body>
</html>